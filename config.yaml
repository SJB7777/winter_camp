experiment_name: "XRefine_Fourier_Metal_v1"
save_root: "D:\\03_Resources\\Data\\XRR_AI\\xrefine"
log_dir: "logs"
device: "cuda"

# [2. Measurement Specs]
q_min_tth: 0.05
q_max_tth: 15.0
q_len: 3000

# [NEW] Data Preprocessing Configuration
data:
  # Normalization mode: "plateau" | "max" | "anchor" | "none"
  # IMPORTANT: Must match the mode used during training!
  # - plateau: Low-angle top-mean = 1.0 (robust, recommended)
  # - max: Global max = 1.0 (simple)
  # - anchor: Specific angle (anchor_tth) = 1.0 (physical)
  # - none: No normalization (raw data)
  normalization_mode: "anchor"  # [USER REQUEST]
  anchor_tth: 0.2               # [USER REQUEST] Target 2theta angle
  plateau_q_limit: 0.08   # For "plateau" mode: Q upper limit


# [3. Instrument Hardware (True Constants)]
# 파장은 하드웨어 고유값이므로 유일한 상수입니다.
instrument:
  wavelength: 1.5406  # Cu K-alpha

# =============================================================================
# [4. Simulation Parameters (Dynamic Training Ranges)]
# AI는 아래 범위 내에서 무작위로 값을 뽑아 학습합니다.
# =============================================================================
sample:
  # 4.1. Global / Instrument Parameters (Variables)
  # [FIX] Section 3에 있던 고정값들을 삭제하고, 여기서 범위로만 관리합니다.
  
  L: [5.0, 30.0]             # Sample Length (mm)
  beam_width: [0.02, 0.4]    # Beam Width (mm) - 학습 시엔 변동, 피팅 시엔 고정 가능
  dq: [0.0005, 0.02]         # Resolution (Instrumental broadening)
  
  i0: [0.8, 1.2]             # Intensity Scale
  bkg: [-10.0, -5.0]         # Background Level (log scale)
  tth_offset: [-0.05, 0.05]  # Zero-point error

  # 4.2. Substrate
  substrate:
    name: "Substrate"
    roughness: [0.0, 8.0]
    sld: [18.0, 22.0]
    sld_imag: [0.0, 1.0]

  # 4.3. Layers
  layers:
    - name: "Top_Layer"
      thickness: [0.0, 50.0]
      roughness: [0.0, 10.0]
      sld: [0.0, 50.0]
      sld_imag: [0.0, 1.0]
      repeats: 1

    - name: "Target_Film"
      thickness: [10.0, 1200.0] 
      roughness: [0.0, 30.0]
      sld: [0.0, 150.0]
      sld_imag: [0.0, 15.0]
      repeats: 1

# [5. Augmentation Config]
augmentations:
  intensity_noise_scale: 0.02
  bg_range: [-10.0, -6.0]
  res_sigma_range: [0.0001, 0.005]
  q_shift_sigma: 0.001
  beam_profile: "gaussian"
  measure_step_range: [0.001, 0.1]

# [6. Training Hyperparameters]
train:
  batch_size: 512
  lr: 0.002
  weight_decay: 1.0e-4
  epochs: 300
  steps_per_epoch: 20
  warmup_steps: 200

  sup_w_start: 10000.0
  sup_w_end: 100.0
  phys_penalty_w: 1.0

  # Loss Component Weights
  w_linear: 20.0
  w_gradient: 50.0
  w_log_base: 50.0
  
  # ===========================================================================
  # [Focus Strategy] Weights Definition
  # ===========================================================================
  weights:
    
    # Layer-specific Priority
    specific_layer_weights:
      Target_Film:
        thickness: 200.0  # [Crucial] Thickness accuracy
        sld: 100.0        # [Crucial] Density accuracy
        sld_imag: 50.0    # [Important] Absorption
        roughness: 20.0   
        
      Top_Layer:          # Nuisance Layer
        thickness: 5    
        roughness: 5    
        sld: 5
        sld_imag: 2     
        
      Substrate:          # Nuisance Layer
        roughness: 5    
        sld: 5          
        sld_imag: 2
    
    # Global Parameter Weights (Low Priority)
    global_weights:       
      i0: 0.0  # [USER REQUEST] Fixed to 1.0 by normalization, no need to learn
      bkg: 1.0
      L: 0.1
      beam_width: 0.1
      dq: 1.0
      tth_offset: 1.0

# =============================================================================
# [7. Model Architecture]
# =============================================================================
model:
  # [Core] Fourier-CNN Model
  model_type: "fourier_conv" 
  
  # [Optimization] Diet Plan for A100 Speedup
  hidden_dim: 64          # 256 -> 64 (Parameters Reduction)
  encoder_depth: 6
  mapping_size: 64        # Fourier Features
  fourier_scale: 40.0
  dim_feedforward: 512    # 1024 -> 512
  dropout: 0.1
  activation: "leaky_relu"